apiVersion: v1
kind: Pod
metadata:
  name: list-topics
  annotations:
    helm.sh/hook: test
spec:
  restartPolicy: Never

  initContainers:
    - name: generate-properties
      image: bitnami/kafka:2.8.0
      command: [sh, /scripts/create_properties.sh]
      env:
        - name: BOOTSTRAP_ENDPOINT
          value: default-kafka-bootstrap:9092
      volumeMounts:
        - mountPath: /scripts
          name: generate-properties
        - mountPath: /properties
          name: properties
        - mountPath: /ssl/client
          name: client-certs
        - mountPath: /ssl/cluster
          name: cluster-ca-certs

  containers:
    - name: list-topics
      command: [kafka-topics.sh]
      args:
        - --command-config=/properties/client.properties
        - --bootstrap-server=default-kafka-bootstrap:9092
        - --list
      env:
        - name: BOOTSTRAP_ENDPOINT
          value: default-kafka-bootstrap:9092
      image: bitnami/kafka:2.8.0
      volumeMounts:
        - mountPath: /properties
          name: properties
        - mountPath: /ssl/client
          name: client-certs
        - mountPath: /ssl/cluster
          name: cluster-ca-certs
  volumes:
    - name: client-certs
      secret:
        defaultMode: 420
        secretName: user
    - name: cluster-ca-certs
      secret:
        defaultMode: 420
        secretName: default-cluster-ca-cert
    - name: generate-properties
      configMap:
        defaultMode: 420
        name: test-generate-properties

    # Shared volume between the init container and the main test containerj
    - name: properties
