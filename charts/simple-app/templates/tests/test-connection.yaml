apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "simple-app.fullname" . }}-test-connection"
  labels:
    {{- include "simple-app.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  restartPolicy: Never
  { { - if or .Values.volumes .Values.volumesString } }
  volumes:
    { { - with .Values.volumes } }{ { toYaml . | nindent 8 } }{ { end } }
    { { - with .Values.volumesString } }{ { tpl . $global | nindent 8 } }{ { end } }
  { { - end } }
  containers:
    - name: test
      image: >-
        {{- if .Values.tests.connection.image.repository }}
        {{ .Values.tests.connection.image.repository }}:{{ default "latest" .Values.tests.connection.image.tag }}
        {{- else }}
        {{ .Values.image.repository }}:{{ default .Chart.AppVersion .Values.image.tag }}
        {{- end }}
      command:
        {{- toYaml .Values.tests.connection.command | nindent 8 }}
      args:
        {{- $global := . }}
        {{- range $arg := index .Values.tests.connection.args }}
        - {{ tpl $arg $global }}
        {{- end }}
      { { - with .Values.volumeMounts } }
      volumeMounts:
        { { - toYaml . | nindent 12 } }
      { { - end } }
