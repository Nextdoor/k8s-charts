# nd-common

A helper chart used by most of our other charts

![Version: 0.0.3](https://img.shields.io/badge/Version-0.0.3-informational?style=flat-square) ![Type: library](https://img.shields.io/badge/Type-library-informational?style=flat-square) ![AppVersion: latest](https://img.shields.io/badge/AppVersion-latest-informational?style=flat-square)

**This chart is a [Library Chart](https://helm.sh/docs/topics/library_charts/)** -
this means that the chart itself deploys no resources, and has no `.yaml`
template files. Instead the intention is for this chart to be included inside
another chart, and the functions that it exposes are then available for use.

## [Datadog Functions](templates/_datadog.tpl)

[unified_service_tagging]: https://docs.datadoghq.com/getting_started/tagging/unified_service_tagging/?tab=kubernetes

### Values Parameters

Each of the functions in the [`templates/_datadog.tpl`](templates/_datadog.tpl)
functions file looks for particularly named values keys. In particular:

* `.Values.datadog.enabled`: This `boolean` parameter will enable or disable the functions documented below.
* `.Values.datadog.env`: Optionally this value will override the ["env" concept in Datadog][unified_service_tagging]
* `.Values.datadog.service`: This string maps to the ["service" concept in Datadog][unified_service_tagging]

### `nd-common.datadogLabels`

This function creates the `tags.datadoghq.com/env`,
`tags.datadoghq.com/service` and `tags.datadoghq.com/version` labels. These
labels should be put within the `spec.template.spec.metadata.labels` key inside
your `Deployment`, `DaemonSet` or `StatefulSet` resources.

_Example Usage_:

```yaml
# templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ...
...
spec:
  template:
    metadata:
      labels:
        {{- include "nd-common.datadogLabels" . | nindent 8 }}
```

### `nd-common.datadogEnv`

```yaml
# templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ...
...
spec:
  template:
    ...
    spec:
      containers:
        - name: myapp
          env:
            {{- include "nd-common.datadogEnv" . | nindent 12 }}
```

## [Istio Functions](templates/istio.tpl)

### Values Parameters

* `.Values.istio.enabled` (default: `True`): Controls whether or not the Istio
  functions are enabled or disabled. Also used in some other monitoring
  functions.

* `.Values.istio.preStopCommand`: A string representing a command that will run
  within the pod before the Istio Envoy sidecar will begin shutting down. This
  setting can be used to ensure that the `envoy` process continues to allow
  traffic to flow while your application begins handling the `SIGTERM` from the
  Kubelet. Eg: `/bin/sleep 30`. _If this is set, then this takes priority over
  the value of `.Values.ports[]` below.

* `.Values.ports[]`: If your application exposes ports, and you do _not_ set a
  `preStopCommand`, then we will configure the `istio-proxy` sidecar to loop
  until it finds no TCP ports in the `LISTENING` state. This is a reasonably
  safe default behavior to ensure that the proxy does not shut down until all
  other traffic has stopped.

### `nd-common.istioAnnotations`

There are a number of common [Istio Resource
Annotations](https://istio.io/latest/docs/reference/config/annotations/) that
we want to apply to most of our workloads. These annotations are generally safe
to apply as defaults, and then we have certain `Values` parameters that we can
override to change the behavior when necessary.

_Example Usage_:
```yaml
# templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ...
...
spec:
  template:
    metadata:
      annotations:
        {{- include "nd-common.istioAnnotations" . | nindent 8 }}
```

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.5.0](https://github.com/norwoodj/helm-docs/releases/v1.5.0)
